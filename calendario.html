<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Calendario de Citas - Yuridia Makeup</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Scripts de Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, where, getDocs, doc, deleteDoc, updateDoc, addDoc, setDoc, getDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyDdO86LeB2mUWeCb85FPw03XPR_ulGfIZA",
            authDomain: "citas-yuridia-makeup.firebaseapp.com",
            projectId: "citas-yuridia-makeup",
            storageBucket: "citas-yuridia-makeup.firebasestorage.app",
            messagingSenderId: "423454216995",
            appId: "1:423454216995:web:ec6f6b8f2b9bba4054b296",
            measurementId: "G-MHPETD64SS"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Exportar todas las funciones necesarias para que est√©n disponibles globalmente
        window.db = db;
        window.firebase = { 
            collection, 
            onSnapshot, 
            query, 
            where, 
            getDocs, 
            doc, 
            deleteDoc, 
            updateDoc, 
            addDoc, 
            setDoc, 
            getDoc, 
            orderBy 
        };
    </script>
    <style>
        /* Advanced Design System for Calendar */
        :root {
            --brand-rose: #e91e63;
            --brand-gold: #d4af37;
            --brand-charcoal: #2c2c2c;
            --brand-light: #fef7f7;
            --brand-gradient: linear-gradient(135deg, #e91e63 0%, #d4af37 50%, #e91e63 100%);
            
            /* Futuristic Color Palette */
            --neon-blue: #00d2ff;
            --neon-purple: #8a2be2;
            --neon-green: #00ff88;
            --neon-pink: #ff006e;
            --cyber-dark: #0a0a0f;
            --cyber-gray: #1a1a2e;
            --cyber-light: #16213e;
            
            /* Advanced Glass Morphism */
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            
            /* Futuristic Gradients */
            --gradient-cyber: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-neon: linear-gradient(45deg, #00d2ff 0%, #8a2be2 50%, #ff006e 100%);
            --gradient-hologram: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            --gradient-glass: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            
            /* Animation Variables */
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            /* Typography */
            --font-display: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-2xl: 32px;
        }

        /* Futuristic Background */
        body {
            font-family: var(--font-display);
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 210, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(138, 43, 226, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 0, 110, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #ffffff;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background Grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 210, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 210, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-move 20s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes grid-move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Advanced Glass Morphism */
        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            position: relative;
            overflow: hidden;
        }

        .glass-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s;
        }

        .glass-effect:hover::before {
            left: 100%;
        }

        /* Holographic Calendar */
        .calendar {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--radius-2xl);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 8px 24px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .calendar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-neon);
            animation: neon-pulse 2s ease-in-out infinite alternate;
        }

        @keyframes neon-pulse {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Futuristic Calendar Header */
        .calendar-header {
            background: var(--gradient-hologram);
            color: white;
            border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
            position: relative;
            overflow: hidden;
        }

        .calendar-header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Advanced Calendar Day Cells */
        .calendar-day {
            min-height: 120px;
            transition: var(--transition-smooth);
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .calendar-day::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-glass);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .calendar-day:hover::before {
            opacity: 1;
        }

        .calendar-day:hover {
            transform: translateY(-2px);
            border-color: rgba(0, 210, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 210, 255, 0.2);
        }

        /* Today Indicator */
        .calendar-day.today {
            background: linear-gradient(135deg, rgba(0, 210, 255, 0.2) 0%, rgba(138, 43, 226, 0.1) 100%);
            border: 2px solid var(--neon-blue);
            box-shadow: 
                0 0 20px rgba(0, 210, 255, 0.4),
                inset 0 0 20px rgba(0, 210, 255, 0.1);
            animation: today-glow 2s ease-in-out infinite alternate;
        }

        @keyframes today-glow {
            0% { box-shadow: 0 0 20px rgba(0, 210, 255, 0.4), inset 0 0 20px rgba(0, 210, 255, 0.1); }
            100% { box-shadow: 0 0 30px rgba(0, 210, 255, 0.6), inset 0 0 30px rgba(0, 210, 255, 0.2); }
        }

        /* Days with Appointments */
        .calendar-day.has-appointments {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15) 0%, rgba(138, 43, 226, 0.05) 100%);
            border-color: rgba(0, 255, 136, 0.3);
            position: relative;
        }

        .calendar-day.has-appointments::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            background: var(--neon-green);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--neon-green);
            animation: appointment-pulse 1.5s ease-in-out infinite;
        }

        @keyframes appointment-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* Futuristic Appointment Items */
        .appointment-item {
            font-size: 0.7rem;
            padding: 4px 6px;
            margin: 2px 0;
            border-radius: var(--radius-sm);
            background: var(--gradient-neon);
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 210, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .appointment-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.4s;
        }

        .appointment-item:hover::before {
            left: 100%;
        }

        /* Modern Buttons */
        .btn-futuristic {
            background: var(--gradient-cyber);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 600;
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-futuristic::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.4s;
        }

        .btn-futuristic:hover::before {
            left: 100%;
        }

        .btn-futuristic:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        /* Holographic Modal */
        .modal-futuristic {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(22, 33, 62, 0.95) 100%);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-2xl);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                0 12px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .modal-futuristic::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-neon);
            animation: loading-bar 2s ease-in-out infinite;
        }

        @keyframes loading-bar {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Enhanced Typography */
        .text-neon {
            background: var(--gradient-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .text-hologram {
            background: var(--gradient-hologram);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        /* Estilos espec√≠ficos para botones de WhatsApp */
        .whatsapp-btn {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%) !important;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
            transition: all 0.3s ease;
        }

        .whatsapp-btn:hover {
            background: linear-gradient(135deg, #128c7e 0%, #075e54 100%) !important;
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.6);
            transform: translateY(-2px);
        }

        .edit-appointment-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .edit-appointment-btn:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%) !important;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 640px) {
            .calendar-grid {
                grid-template-columns: repeat(1, 1fr);
            }
            
            .calendar-day {
                min-height: auto;
                padding: 1rem;
            }
            
            .appointment-item {
                font-size: 0.75rem;
                padding: 6px 8px;
            }
        }

        /* Loading Animation */
        .loading-pulse {
            animation: pulse-glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse-glow {
            0% { 
                box-shadow: 0 0 5px rgba(0, 210, 255, 0.5);
                border-color: rgba(0, 210, 255, 0.3);
            }
            100% { 
                box-shadow: 0 0 20px rgba(0, 210, 255, 0.8);
                border-color: rgba(0, 210, 255, 0.6);
            }
        }

        /* Micro-interactions */
        .micro-bounce {
            transition: var(--transition-bounce);
        }

        .micro-bounce:hover {
            transform: scale(1.05);
        }

        .micro-bounce:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="p-4">
    <div class="container mx-auto max-w-7xl">
        <!-- Futuristic Header -->
        <header class="glass-effect rounded-3xl mb-12 p-8">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-6">
                <div class="text-center lg:text-left">
                    <h1 class="text-4xl md:text-6xl font-bold text-hologram mb-4">
                        üöÄ Calendario Inteligente
                    </h1>
                    <p class="text-gray-300 text-lg leading-relaxed">
                        Vista temporal avanzada de todas las citas programadas
                    </p>
                    <div class="flex items-center justify-center lg:justify-start mt-4 space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-neon-blue rounded-full animate-pulse"></div>
                            <span class="text-sm text-gray-400">Sistema en l√≠nea</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-neon-green rounded-full"></div>
                            <span class="text-sm text-gray-400">Sincronizado</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-neon-pink rounded-full"></div>
                            <span class="text-sm text-gray-400">Tiempo real</span>
                        </div>
                    </div>
                </div>
                <nav class="flex flex-col sm:flex-row gap-4">
                    <button id="prev-month" class="btn-futuristic micro-bounce">
                        <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        Mes Anterior
                    </button>
                    <button id="today-btn" class="btn-futuristic micro-bounce">
                        <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"/>
                        </svg>
                        Hoy
                    </button>
                    <button id="next-month" class="btn-futuristic micro-bounce">
                        Mes Siguiente
                        <svg class="w-5 h-5 ml-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Stats Dashboard -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="glass-effect rounded-2xl p-6 text-center">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 8a2 2 0 11-4 0m4 0a2 2 0 104 0m-4 0V9a2 2 0 014 0v4"/>
                    </svg>
                </div>
                <h3 id="total-appointments" class="text-3xl font-bold text-neon mb-2">0</h3>
                <p class="text-gray-400">Citas Este Mes</p>
            </div>
            
            <div class="glass-effect rounded-2xl p-6 text-center">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-green-500 to-teal-600 flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/>
                    </svg>
                </div>
                <h3 id="confirmed-appointments" class="text-3xl font-bold text-neon mb-2">0</h3>
                <p class="text-gray-400">Confirmadas</p>
            </div>
            
            <div class="glass-effect rounded-2xl p-6 text-center">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-pink-500 to-rose-600 flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3"/>
                    </svg>
                </div>
                <h3 id="pending-appointments" class="text-3xl font-bold text-neon mb-2">0</h3>
                <p class="text-gray-400">Pendientes</p>
            </div>
        </div>

        <!-- Holographic Calendar -->
        <div class="calendar">
            <div class="calendar-header p-6">
                <h2 id="current-month" class="text-2xl md:text-4xl font-bold text-center text-white"></h2>
                <div class="text-center mt-2 text-gray-200 opacity-90">
                    <span id="month-stats" class="text-sm"></span>
                </div>
            </div>
            
            <!-- Enhanced Days Header -->
            <div class="grid grid-cols-7 text-center font-bold border-b border-gray-600 py-4 bg-gradient-to-r from-gray-800 to-gray-700">
                <div class="text-red-400">DOM</div>
                <div class="text-blue-400">LUN</div>
                <div class="text-green-400">MAR</div>
                <div class="text-purple-400">MI√â</div>
                <div class="text-yellow-400">JUE</div>
                <div class="text-pink-400">VIE</div>
                <div class="text-cyan-400">S√ÅB</div>
            </div>
            
            <!-- Enhanced Calendar Grid -->
            <div id="calendar-grid" class="grid grid-cols-7 min-h-[600px]"></div>
        </div>

        <!-- Futuristic Modal -->
        <div id="appointment-modal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center hidden z-50">
            <div class="modal-futuristic p-8 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h3 class="text-2xl md:text-3xl font-bold text-hologram" id="modal-date"></h3>
                        <p class="text-gray-400 mt-2">Detalles de citas programadas</p>
                    </div>
                    <button id="close-modal" class="btn-futuristic p-3 text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div id="modal-appointments" class="space-y-6"></div>
                
                <!-- Quick Actions -->
                <div class="flex flex-wrap gap-4 mt-8 pt-6 border-t border-gray-600">
                    <button id="add-appointment-btn" class="btn-futuristic text-sm">
                        <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        Agregar Cita
                    </button>
                    <button id="block-schedule-btn" class="btn-futuristic text-sm">
                        <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 8a2 2 0 11-4 0m4 0a2 2 0 104 0m-4 0V9a2 2 0 014 0v4"/>
                        </svg>
                        Bloquear Horario
                    </button>
                    <button id="export-btn" class="btn-futuristic text-sm">
                        <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Exportar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let appointments = [];

        // Elementos DOM
        const calendarGrid = document.getElementById('calendar-grid');
        const currentMonthElement = document.getElementById('current-month');
        const monthStatsElement = document.getElementById('month-stats');
        const prevMonthButton = document.getElementById('prev-month');
        const nextMonthButton = document.getElementById('next-month');
        const todayButton = document.getElementById('today-btn');
        const appointmentModal = document.getElementById('appointment-modal');
        const closeModalButton = document.getElementById('close-modal');
        const modalDate = document.getElementById('modal-date');
        const modalAppointments = document.getElementById('modal-appointments');
        
        // Stats elements
        const totalAppointmentsElement = document.getElementById('total-appointments');
        const confirmedAppointmentsElement = document.getElementById('confirmed-appointments');
        const pendingAppointmentsElement = document.getElementById('pending-appointments');

        // Enhanced Navigation Events
        if (prevMonthButton) {
            prevMonthButton.addEventListener('click', () => {
                console.log('Bot√≥n mes anterior clickeado');
                try {
                    currentDate.setMonth(currentDate.getMonth() - 1);
                    animateTransition(() => {
                        renderCalendar();
                        loadAppointments();
                    });
                } catch (error) {
                    console.error('Error en navegaci√≥n mes anterior:', error);
                }
            });
        } else {
            console.error('Bot√≥n prev-month no encontrado');
        }

        if (nextMonthButton) {
            nextMonthButton.addEventListener('click', () => {
                console.log('Bot√≥n mes siguiente clickeado');
                try {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                    animateTransition(() => {
                        renderCalendar();
                        loadAppointments();
                    });
                } catch (error) {
                    console.error('Error en navegaci√≥n mes siguiente:', error);
                }
            });
        } else {
            console.error('Bot√≥n next-month no encontrado');
        }

        if (todayButton) {
            todayButton.addEventListener('click', () => {
                console.log('Bot√≥n hoy clickeado');
                try {
                    currentDate = new Date();
                    animateTransition(() => {
                        renderCalendar();
                        loadAppointments();
                    });
                } catch (error) {
                    console.error('Error en navegaci√≥n a hoy:', error);
                }
            });
        } else {
            console.error('Bot√≥n today-btn no encontrado');
        }

        if (closeModalButton) {
            closeModalButton.addEventListener('click', () => {
                console.log('Bot√≥n cerrar modal clickeado');
                if (appointmentModal) {
                    appointmentModal.classList.add('hidden');
                } else {
                    console.error('Modal de citas no encontrado');
                }
            });
        } else {
            console.error('Bot√≥n close-modal no encontrado');
        }

        // Event listeners para botones del modal
        const addAppointmentBtn = document.getElementById('add-appointment-btn');
        const blockScheduleBtn = document.getElementById('block-schedule-btn');
        const exportBtn = document.getElementById('export-btn');

        if (addAppointmentBtn) {
            addAppointmentBtn.addEventListener('click', () => {
                console.log('Bot√≥n agregar cita clickeado');
                // Redirigir a la p√°gina de admin para crear una cita
                window.open('admin.html', '_blank');
            });
        }

        if (blockScheduleBtn) {
            blockScheduleBtn.addEventListener('click', () => {
                console.log('Bot√≥n bloquear horario clickeado');
                // Redirigir a la p√°gina de admin para bloquear horarios
                window.open('admin.html#horarios', '_blank');
            });
        }

        if (exportBtn) {
            exportBtn.addEventListener('click', () => {
                console.log('Bot√≥n exportar clickeado');
                exportCalendarData();
            });
        }

        // Funci√≥n para exportar datos del calendario
        function exportCalendarData() {
            try {
                const monthName = new Date(currentDate.getFullYear(), currentDate.getMonth()).toLocaleString('es-ES', { month: 'long', year: 'numeric' });
                const csvContent = [
                    ['Fecha', 'Hora', 'Cliente', 'Tel√©fono', 'Servicio', 'Estado'],
                    ...appointments.map(app => [
                        app.fecha,
                        app.hora,
                        app.nombre,
                        app.telefono,
                        app.servicio,
                        app.confirmada ? 'Confirmada' : 'Pendiente'
                    ])
                ].map(row => row.join(',')).join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `citas_${monthName.replace(' ', '_')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                console.log('Archivo CSV exportado exitosamente');
            } catch (error) {
                console.error('Error al exportar datos:', error);
                alert('Error al exportar los datos del calendario');
            }
        }

        // Event listeners para botones din√°micos usando delegaci√≥n de eventos
        if (appointmentModal) {
            // Event listener para botones de WhatsApp
            appointmentModal.addEventListener('click', (e) => {
                if (e.target.closest('.whatsapp-btn')) {
                    e.preventDefault();
                    const button = e.target.closest('.whatsapp-btn');
                    const phone = button.dataset.phone;
                    const name = button.dataset.name;
                    const service = button.dataset.service;
                    const date = button.dataset.date;
                    const time = button.dataset.time;
                    
                    console.log('Abriendo WhatsApp para:', name, phone);
                    openWhatsApp(phone, name, service, date, time);
                }
                
                // Event listener para botones de editar
                if (e.target.closest('.edit-appointment-btn')) {
                    e.preventDefault();
                    const button = e.target.closest('.edit-appointment-btn');
                    const appointmentId = button.dataset.appointmentId;
                    const appointmentData = JSON.parse(button.dataset.appointmentData);
                    
                    console.log('Editando cita:', appointmentId, appointmentData);
                    editAppointment(appointmentId, appointmentData);
                }
            });
        }

        // Funci√≥n para abrir WhatsApp con mensaje predefinido
        function openWhatsApp(phone, name, service, date, time) {
            try {
                // Limpiar el n√∫mero de tel√©fono (solo n√∫meros)
                const cleanPhone = phone.replace(/\D/g, '');
                
                // Formatear la fecha
                const formattedDate = new Date(date).toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Crear mensaje personalizado
                const message = `¬°Hola ${name}! üëã

Espero que est√©s muy bien. Te escribo desde *Yuridia Makeup* para confirmar tu cita:

üìÖ *Fecha:* ${formattedDate}
‚è∞ *Hora:* ${time}
üíÑ *Servicio:* ${service}

¬øPodr√≠as confirmarme si mantienes la cita para esa fecha y hora? 

¬°Estoy emocionada de trabajar contigo! ‚ú®

_Yuridia Makeup - Transformando tu belleza natural_ üíï`;

                // Codificar el mensaje para URL
                const encodedMessage = encodeURIComponent(message);
                
                // Crear el enlace de WhatsApp
                const whatsappUrl = `https://wa.me/52${cleanPhone}?text=${encodedMessage}`;
                
                // Abrir WhatsApp en nueva ventana
                window.open(whatsappUrl, '_blank');
                
                console.log('WhatsApp abierto para:', cleanPhone);
            } catch (error) {
                console.error('Error al abrir WhatsApp:', error);
                alert('Error al abrir WhatsApp. Verifica que el n√∫mero de tel√©fono sea v√°lido.');
            }
        }

        // Funci√≥n para editar cita
        function editAppointment(appointmentId, appointmentData) {
            try {
                // Crear una URL con par√°metros para pre-llenar el formulario de edici√≥n
                const editUrl = `admin.html?edit=${appointmentId}&name=${encodeURIComponent(appointmentData.nombre)}&phone=${encodeURIComponent(appointmentData.telefono)}&service=${encodeURIComponent(appointmentData.servicio)}&date=${appointmentData.fecha}&time=${appointmentData.hora}`;
                
                // Abrir la p√°gina de admin con los datos de edici√≥n
                window.open(editUrl, '_blank');
                
                console.log('Abriendo editor para cita:', appointmentId);
            } catch (error) {
                console.error('Error al abrir editor de cita:', error);
                alert('Error al abrir el editor de citas.');
            }
        }

        // Enhanced transition animation
        function animateTransition(callback) {
            calendarGrid.style.opacity = '0.5';
            calendarGrid.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                callback();
                calendarGrid.style.opacity = '1';
                calendarGrid.style.transform = 'scale(1)';
            }, 200);
        }

        // Enhanced appointment loading with stats
        async function loadAppointments() {
            console.log('Cargando citas...');
            if (!window.db || !window.firebase) {
                console.error('Firebase no est√° disponible');
                showErrorState();
                return;
            }

            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            
            console.log('Rango de fechas:', firstDay.toISOString().split('T')[0], 'a', lastDay.toISOString().split('T')[0]);

            const citasRef = window.firebase.collection(window.db, 'citas');
            const q = window.firebase.query(
                citasRef,
                window.firebase.where('fecha', '>=', firstDay.toISOString().split('T')[0]),
                window.firebase.where('fecha', '<=', lastDay.toISOString().split('T')[0])
            );

            try {
                const querySnapshot = await window.firebase.getDocs(q);
                appointments = [];
                querySnapshot.forEach((doc) => {
                    appointments.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('Citas cargadas:', appointments.length);
                updateStats();
                renderAppointments();
            } catch (error) {
                console.error('Error al cargar las citas:', error);
                showErrorState();
            }
        }

        // Enhanced stats calculation
        function updateStats() {
            const total = appointments.length;
            const confirmed = appointments.filter(app => app.confirmada).length;
            const pending = total - confirmed;

            // Animate counters
            animateCounter(totalAppointmentsElement, total);
            animateCounter(confirmedAppointmentsElement, confirmed);
            animateCounter(pendingAppointmentsElement, pending);

            // Update month stats
            const monthName = new Date(currentDate.getFullYear(), currentDate.getMonth()).toLocaleString('es-ES', { month: 'long' });
            monthStatsElement.textContent = `${total} citas programadas en ${monthName}`;
        }

        // Counter animation
        function animateCounter(element, target) {
            const current = parseInt(element.textContent) || 0;
            const increment = target > current ? 1 : -1;
            const timer = setInterval(() => {
                const value = parseInt(element.textContent) || 0;
                if (value === target) {
                    clearInterval(timer);
                } else {
                    element.textContent = value + increment;
                }
            }, 50);
        }

        // Enhanced calendar rendering
        function renderCalendar() {
            console.log('Renderizando calendario para:', currentDate);
            
            if (!calendarGrid) {
                console.error('Elemento calendar-grid no encontrado');
                return;
            }
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update month header with enhanced styling
            const monthName = new Date(year, month).toLocaleString('es-ES', { month: 'long' });
            if (currentMonthElement) {
                currentMonthElement.innerHTML = `
                    <span class="text-hologram">${monthName.charAt(0).toUpperCase() + monthName.slice(1)}</span>
                    <span class="text-neon">${year}</span>
                `;
            }

            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            const totalDays = lastDayOfMonth.getDate();
            const firstDayOfWeek = firstDayOfMonth.getDay();

            calendarGrid.innerHTML = '';
            console.log('Generando', totalDays, 'd√≠as para el calendario');

            // Add empty cells with subtle indicators
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day p-4 opacity-30';
                emptyCell.innerHTML = '<div class="text-gray-600"></div>';
                calendarGrid.appendChild(emptyCell);
            }

            // Enhanced day cells
            for (let day = 1; day <= totalDays; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day p-4 relative cursor-pointer';
                
                const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();
                if (isToday) {
                    dayCell.classList.add('today');
                }

                // Enhanced day display
                dayCell.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="font-bold text-lg ${isToday ? 'text-white' : 'text-gray-200'}">${day}</div>
                        <div class="appointment-indicator hidden">
                            <div class="w-2 h-2 bg-neon-green rounded-full"></div>
                        </div>
                    </div>
                    <div class="appointments-container space-y-1"></div>
                `;

                // Enhanced click handler
                dayCell.addEventListener('click', () => {
                    // Add click animation
                    dayCell.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        dayCell.style.transform = 'scale(1)';
                        showDayDetails(year, month, day);
                    }, 100);
                });

                calendarGrid.appendChild(dayCell);
            }
        }

        // Enhanced appointment rendering
        function renderAppointments() {
            // Clear existing appointments
            document.querySelectorAll('.appointments-container').forEach(container => {
                container.innerHTML = '';
            });

            // Group appointments by date
            const appointmentsByDate = {};
            appointments.forEach(appointment => {
                if (!appointmentsByDate[appointment.fecha]) {
                    appointmentsByDate[appointment.fecha] = [];
                }
                appointmentsByDate[appointment.fecha].push(appointment);
            });

            // Enhanced appointment display
            Object.entries(appointmentsByDate).forEach(([date, dayAppointments]) => {
                const [year, month, day] = date.split('-').map(Number);
                
                if (year === currentDate.getFullYear() && month - 1 === currentDate.getMonth()) {
                    const dayCell = document.querySelectorAll('.calendar-day')[day + new Date(year, month - 1, 1).getDay() - 1];
                    if (dayCell) {
                        const container = dayCell.querySelector('.appointments-container');
                        const indicator = dayCell.querySelector('.appointment-indicator');
                        
                        // Show indicator
                        if (indicator) indicator.classList.remove('hidden');
                        
                        // Sort appointments by time
                        dayAppointments.sort((a, b) => a.hora.localeCompare(b.hora));
                        
                        dayAppointments.forEach((appointment, index) => {
                            if (index < 2) {
                                const appointmentElement = document.createElement('div');
                                appointmentElement.className = 'appointment-item micro-bounce';
                                appointmentElement.innerHTML = `
                                    <div class="flex items-center justify-between">
                                        <span class="font-semibold">${appointment.hora}</span>
                                        <span class="text-xs opacity-80">${appointment.confirmada ? '‚úì' : '‚è≥'}</span>
                                    </div>
                                    <div class="text-xs opacity-90 truncate">${appointment.nombre}</div>
                                `;
                                container.appendChild(appointmentElement);
                            } else if (index === 2) {
                                const moreElement = document.createElement('div');
                                moreElement.className = 'text-xs text-neon font-semibold mt-1 text-center';
                                moreElement.textContent = `+${dayAppointments.length - 2} m√°s`;
                                container.appendChild(moreElement);
                            }
                        });
                        
                        dayCell.classList.add('has-appointments');
                    }
                }
            });
        }
        // Enhanced modal for day details
        function showDayDetails(year, month, day) {
            const date = new Date(year, month, day);
            const dateString = date.toISOString().split('T')[0];
            
            // Enhanced modal title
            modalDate.innerHTML = `
                <span class="text-neon">${date.toLocaleDateString('es-ES', { weekday: 'long' })}</span><br>
                <span class="text-2xl">${date.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
            `;

            // Filter and sort appointments
            const dayAppointments = appointments.filter(app => app.fecha === dateString);
            dayAppointments.sort((a, b) => a.hora.localeCompare(b.hora));

            // Enhanced appointment cards
            modalAppointments.innerHTML = dayAppointments.length > 0 
                ? dayAppointments.map((appointment, index) => `
                    <div class="glass-effect rounded-xl p-6 hover:bg-opacity-20 transition-all duration-300" style="animation-delay: ${index * 0.1}s">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="font-bold text-lg text-white">${appointment.nombre}</div>
                                        <div class="text-gray-400 text-sm">${appointment.servicio}</div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div class="flex items-center gap-2">
                                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3"/>
                                        </svg>
                                        <span class="text-gray-300">Hora: ${appointment.hora}</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                        </svg>
                                        <a href="tel:${appointment.telefono}" class="text-blue-400 hover:text-blue-300 transition">${appointment.telefono}</a>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="ml-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${
                                    appointment.confirmada 
                                        ? 'bg-green-500 bg-opacity-20 text-green-400 border border-green-500' 
                                        : 'bg-yellow-500 bg-opacity-20 text-yellow-400 border border-yellow-500'
                                }">
                                    ${appointment.confirmada ? '‚úì Confirmada' : '‚è≥ Pendiente'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="flex gap-3 pt-4 border-t border-gray-600">
                            <button class="btn-futuristic text-xs px-3 py-2 edit-appointment-btn" 
                                    data-appointment-id="${appointment.id}"
                                    data-appointment-data='${JSON.stringify(appointment)}'>
                                <svg class="w-3 h-3 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                                Editar
                            </button>
                            <button class="btn-futuristic text-xs px-3 py-2 bg-gradient-to-r from-green-500 to-teal-600 whatsapp-btn" 
                                    data-phone="${appointment.telefono}"
                                    data-name="${appointment.nombre}"
                                    data-service="${appointment.servicio}"
                                    data-date="${appointment.fecha}"
                                    data-time="${appointment.hora}">
                                <svg class="w-3 h-3 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                </svg>
                                WhatsApp
                            </button>
                        </div>
                    </div>
                `).join('')
                : `
                    <div class="text-center py-12">
                        <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-gray-600 to-gray-700 flex items-center justify-center">
                            <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 8a2 2 0 11-4 0m4 0a2 2 0 104 0m-4 0V9a2 2 0 014 0v4"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-300 mb-2">D√≠a libre</h3>
                        <p class="text-gray-500">No hay citas programadas para este d√≠a</p>
                    </div>
                `;

            // Show modal with animation
            appointmentModal.classList.remove('hidden');
            setTimeout(() => {
                appointmentModal.querySelector('.modal-futuristic').style.transform = 'scale(1)';
                appointmentModal.querySelector('.modal-futuristic').style.opacity = '1';
            }, 10);
        }

        // Error state handler
        function showErrorState() {
            calendarGrid.innerHTML = `
                <div class="col-span-7 text-center py-12">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-red-500 to-pink-600 flex items-center justify-center">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.864-.833-2.634 0L4.18 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-red-400 mb-2">Error de conexi√≥n</h3>
                    <p class="text-gray-500">No se pudieron cargar las citas. Intenta recargar la p√°gina.</p>
                </div>
            `;
        }

        // Funci√≥n para esperar a que Firebase est√© listo
        function waitForFirebase(callback) {
            if (window.db && window.firebase) {
                console.log('Firebase est√° listo');
                callback();
            } else {
                console.log('Esperando Firebase...');
                setTimeout(() => waitForFirebase(callback), 100);
            }
        }

        // Enhanced initialization
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM cargado, inicializando calendario...');
            
            // Add loading state
            if (calendarGrid) {
                calendarGrid.innerHTML = `
                    <div class="col-span-7 text-center py-12">
                        <div class="loading-pulse w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                            <svg class="w-10 h-10 text-white animate-spin" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-blue-400 mb-2">Cargando calendario...</h3>
                        <p class="text-gray-500">Sincronizando con la base de datos</p>
                    </div>
                `;
                
                // Esperar a que Firebase est√© listo antes de inicializar
                waitForFirebase(() => {
                    console.log('Iniciando renderizado del calendario...');
                    renderCalendar();
                    loadAppointments();
                });
            } else {
                console.error('Elemento calendar-grid no encontrado');
            }
        });

        // Confirmar que el script se ha cargado
        console.log('Script del calendario cargado correctamente');
    </script>
</body>
</html>
